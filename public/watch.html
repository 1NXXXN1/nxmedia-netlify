<!doctype html>
<html>
<head><meta charset="utf-8"/><title>NXMEDIA — Player</title></head>
<body>
  <div id="player-root" style="max-width:900px;margin:auto;padding:16px">
    <h2 id="title">Yuklanmoqda...</h2>
    <img id="poster" style="max-width:200px;display:block;margin-bottom:12px"/>
    <div id="meta"></div>
    <div id="player-placeholder" style="margin-top:12px;padding:12px;border:1px dashed #ccc">
      Bu joyga video manbaini qo‘shing (hozir player yo‘qligi tufayli faqat maʼlumot ko‘rsatiladi).
    </div>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const encoded = params.get('data') || params.get('movie');
    if (!encoded) {
      document.body.innerHTML = '<h3>Film maʼlumoti topilmadi</h3>';
    } else {
      try {
        // If it's a numeric 'movie' id (legacy), just show it:
        if (!encoded.includes('{') && !encoded.includes('%') && !encoded.includes('=') && encoded.length < 30) {
          document.getElementById('title').textContent = 'Movie key: ' + encoded;
          document.getElementById('meta').textContent = 'Legacy key / localStorage based link';
        } else {
          // decode possibly base64 or URI encoded JSON
          let json;
          try {
            json = JSON.parse(atob(decodeURIComponent(encoded)));
          } catch(e) {
            try { json = JSON.parse(atob(encoded)); } catch(e2) { 
              try { json = JSON.parse(decodeURIComponent(encoded)); } catch(e3) { json = null; }
            }
          }
          if (!json) {
            document.getElementById('title').textContent = 'Maʼlumotni ochib bo‘lmadi';
          } else {
            document.getElementById('title').textContent = json.title || json.name || 'Nomaʼlum';
            if (json.poster) document.getElementById('poster').src = json.poster;
            document.getElementById('meta').textContent = 
              'TMDB ID: ' + (json.tmdb||'') + ' | IMDb: ' + (json.imdb||'') + ' | KP: ' + (json.kp||'');
          }
        }
      } catch (e) {
        document.body.innerHTML = '<h3>Maʼlumotni ochishda xato</h3>';
      }
    }
  </script>
</body>
</html>
